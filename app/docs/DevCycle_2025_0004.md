# Development Cycle 2025-0004

**Status:** In Progress  
**Start Date:** 2025-07-26  
**Focus:** Performance Optimization and User Experience Enhancement

## Overview

This development cycle focuses on significant performance improvements and user experience enhancements for PlayStreak. The cycle addresses three major areas: database optimization through independent piece information storage, enhanced data management with granular import/export capabilities, and calendar interface enhancement with verbose mode functionality.

## Current Work Items

### Phase 1: Independent Piece Information Storage
**Status:** âœ… **COMPLETED (2025-07-26)**  
**Date Added:** 2025-07-26  
**Date Completed:** 2025-07-26  
**Priority:** High  
**Description:** Implement independent storage of piece statistics and information to reduce database query overhead and improve app performance.

**Acceptance Criteria:**
- [x] Design and implement enhanced Piece entity with statistical fields
- [x] Create database migration to populate statistics from existing activities
- [x] Modify activity CRUD operations to maintain piece statistics
- [x] Replace expensive activity-based queries with direct piece statistics queries
- [x] Validate data integrity and performance improvements
- [x] Handle favorites storage strategy (separate table implementation)
- [x] Implement import/export strategy for piece statistics (separate export functionality)
- [x] Determine export format (CSV format implemented)

**Technical Implementation Details:**

**Database Schema Enhancement:**
```kotlin
@Entity(tableName = "pieces")
data class Piece(
    @PrimaryKey val id: String,
    val name: String,
    val type: ItemType,
    val dateCreated: Long,
    
    // New independent statistics fields
    val practiceCount: Int = 0,
    val performanceCount: Int = 0,
    val lastPracticeDate: Long? = null,
    val lastPerformanceDate: Long? = null,
    val totalPracticeDuration: Int = 0, // in minutes
    val averagePracticeLevel: Float? = null,
    val lastUpdated: Long = System.currentTimeMillis(),
    
    // Recent activity tracking for better suggestions
    val lastThreePractices: String? = null, // JSON array of timestamps
    val lastThreePerformances: String? = null // JSON array of timestamps
)
```

**Files to Modify:**
- `app/src/main/java/com/pseddev/playstreak/data/entities/Piece.kt`
- `app/src/main/java/com/pseddev/playstreak/data/dao/PieceDao.kt`
- `app/src/main/java/com/pseddev/playstreak/data/dao/ActivityDao.kt`
- `app/src/main/java/com/pseddev/playstreak/data/AppDatabase.kt` (migration)
- `app/src/main/java/com/pseddev/playstreak/data/repositories/ActivityRepository.kt`
- `app/src/main/java/com/pseddev/playstreak/ui/progress/DashboardViewModel.kt`
- `app/src/main/java/com/pseddev/playstreak/ui/pieces/PiecesViewModel.kt`

**Expected Performance Benefits:**
- Piece-related queries execute in <50ms (down from current 200ms+)
- Faster piece list loading with pre-calculated statistics
- Improved suggestions performance with cached activity data
- Scalable architecture that maintains performance as database grows

**Implementation Sub-Phases:**
1. **Database Schema Design** (1-2 days): Create migration and statistics schema
2. **Data Population** (1-2 days): Migrate existing data and validate integrity
3. **Update Logic Implementation** (2-3 days): Modify CRUD operations for statistics maintenance
4. **Query Optimization** (2-3 days): Replace activity-based queries with statistics queries
5. **Testing & Validation** (1-2 days): Performance testing and user acceptance validation

**Implementation Summary:**

**Files Modified:**
- `app/src/main/java/com/pseddev/playstreak/data/entities/PieceOrTechnique.kt` - Enhanced with statistical fields and recent activity tracking
- `app/src/main/java/com/pseddev/playstreak/data/daos/PieceOrTechniqueDao.kt` - Added statistics-based queries and update methods
- `app/src/main/java/com/pseddev/playstreak/data/AppDatabase.kt` - Added migration and new PieceFavorite entity
- `app/src/main/java/com/pseddev/playstreak/data/repository/PianoRepository.kt` - Enhanced with automatic statistics maintenance
- `app/src/main/java/com/pseddev/playstreak/PlayStreakApplication.kt` - Updated repository initialization

**Files Created:**
- `app/src/main/java/com/pseddev/playstreak/data/entities/PieceFavorite.kt` - Separate favorites entity
- `app/src/main/java/com/pseddev/playstreak/data/daos/PieceFavoriteDao.kt` - Favorites management DAO
- `app/src/main/java/com/pseddev/playstreak/utils/PieceStatisticsHelper.kt` - JSON handling utilities
- `app/src/main/java/com/pseddev/playstreak/utils/PieceStatisticsValidator.kt` - Data integrity validation
- `app/src/main/java/com/pseddev/playstreak/utils/PieceStatisticsCsvExporter.kt` - CSV export functionality

**Key Achievements:**
- âœ… Database schema enhanced with comprehensive piece statistics
- âœ… Automatic statistics maintenance on all activity CRUD operations
- âœ… Separate favorites table implementation for better normalization
- âœ… Direct statistics queries replace expensive activity aggregations
- âœ… Recent activity tracking (last 3) for enhanced suggestion algorithms
- âœ… Separate CSV export functionality for piece statistics
- âœ… Data integrity validation utilities
- âœ… Database migration with automatic statistics population from existing data

**Performance Improvements:**
- Direct piece queries eliminate complex JOIN operations with activities table
- Pre-calculated statistics reduce query execution time from 200ms+ to target <50ms
- Scalable architecture maintains performance as activities database grows
- Foundation established for activity database trimming while preserving statistics

**Future Benefits:**
- Enables activity database trimming while preserving essential statistics
- Foundation for advanced analytics and predictive suggestions
- Long-term data management without losing core information

### Phase 2: Enhanced Import/Export Data Management
**Status:** ðŸŽ« **OPEN**  
**Date Added:** 2025-07-27  
**Priority:** Medium  
**Description:** Add granular export/import capabilities with "Export Pieces to CSV" and "Import Activities from CSV" functionality to provide more flexible data management options.

**Reference:** Ticket #11 - Add Export Pieces TO CSV and Import Activities from CSV

**Acceptance Criteria:**
- [ ] Add "Export Pieces to CSV" button that exports comprehensive piece statistics
- [ ] Add "Import Activities from CSV" button that imports activities without replacing pieces
- [ ] Implement piece statistics export with all relevant data fields
- [ ] Create selective activity import with piece preservation
- [ ] Add proper validation for activity-only imports
- [ ] Provide clear user feedback and error handling
- [ ] Maintain consistent file naming conventions
- [ ] Ensure automatic piece statistics updates after activity import

**Technical Implementation Details:**

**New Export Functionality:**
```kotlin
// Pieces export data structure
data class PieceExportData(
    val id: Long,
    val name: String,
    val type: ItemType,
    val dateCreated: Long,
    val practiceCount: Int,
    val performanceCount: Int,
    val lastPracticeDate: Long?,
    val lastPerformanceDate: Long?,
    val totalPracticeDuration: Int,
    val averagePracticeLevel: Float?,
    val lastUpdated: Long,
    val lastThreePractices: String?,
    val lastThreePerformances: String?,
    val isFavorite: Boolean
)
```

**Files to Modify:**
- `app/src/main/java/com/pseddev/playstreak/ui/importexport/ImportExportFragment.kt`
- `app/src/main/java/com/pseddev/playstreak/ui/importexport/ImportExportViewModel.kt`
- `app/src/main/java/com/pseddev/playstreak/data/repository/PianoRepository.kt`
- `app/src/main/res/layout/fragment_import_export.xml`

**Files to Create:**
- `app/src/main/java/com/pseddev/playstreak/utils/ActivityOnlyImporter.kt`
- Enhanced `PieceStatisticsCsvExporter.kt` functionality

**User Experience Features:**
- **Granular Control**: Export pieces separately from activities
- **Safer Imports**: Import activities without losing existing piece data
- **Data Analysis**: Separate piece statistics file for analysis
- **Backup Flexibility**: More options for partial data backup/restore

**Implementation Sub-Phases:**
1. **Backend Implementation** (2-3 days): Repository methods and utility classes
2. **Frontend Integration** (2-3 days): UI buttons and user interaction flow
3. **Validation & Testing** (1-2 days): Import validation and error handling
4. **Polish & Documentation** (1 day): User feedback and file format documentation

### Phase 3: Verbose Calendar Mode Toggle
**Status:** ðŸŽ« **OPEN**  
**Date Added:** 2025-07-26  
**Priority:** Medium  
**Description:** Add toggle functionality for verbose calendar mode that shows detailed daily activities with edit/delete capabilities, potentially consolidating Calendar and Timeline functionality.

**Acceptance Criteria:**
- [ ] Implement toggle switch in calendar toolbar with preference storage
- [ ] Create expandable day cells showing detailed activity information
- [ ] Integrate edit/delete functionality for activities directly in calendar
- [ ] Add quick-add capability for selected calendar days
- [ ] Ensure smooth performance with large activity datasets
- [ ] Evaluate Timeline tab necessity after verbose mode implementation
- [ ] Implement smooth expand/collapse animations
- [ ] Add comprehensive testing and user feedback collection

**Technical Implementation Details:**

**UI Enhancement Components:**
```kotlin
// Enhanced calendar day representation
data class VerboseCalendarDay(
    val date: LocalDate,
    val activities: List<Activity>,
    val isExpanded: Boolean = false,
    val totalDuration: Int,
    val practiceCount: Int,
    val performanceCount: Int
)
```

**Files to Modify:**
- `app/src/main/java/com/pseddev/playstreak/ui/progress/CalendarFragment.kt`
- `app/src/main/java/com/pseddev/playstreak/ui/progress/CalendarViewModel.kt`
- `app/src/main/res/layout/fragment_calendar.xml`
- `app/src/main/res/layout/calendar_day_verbose.xml` (new)
- `app/src/main/java/com/pseddev/playstreak/ui/progress/CalendarDayAdapter.kt` (new)
- `app/src/main/java/com/pseddev/playstreak/utils/PreferencesManager.kt`

**User Experience Features:**
- **Day Selection**: Tap to expand detailed activity view for any day
- **Activity Management**: Edit, delete, and add activities directly from calendar context
- **Visual Integration**: Maintain calendar's visual practice pattern representation
- **Toggle Persistence**: Remember user preference between app sessions

**Implementation Sub-Phases:**
1. **Basic Verbose Mode** (2-3 days): Toggle functionality and expandable day cells
2. **Interactive Features** (2-3 days): Edit/delete/add functionality integration
3. **UI Polish & Performance** (1-2 days): Animations and optimization
4. **Timeline Evaluation** (1-2 days): Assessment of Timeline tab necessity

**Timeline Tab Consideration:**
This feature may allow consolidation of Calendar and Timeline functionality, simplifying app navigation while providing enhanced user experience. Evaluation will determine whether Timeline tab remains necessary.


## Success Criteria

### Phase 1 Success Metrics
- [ ] Database query performance improved by 75% for piece-related operations
- [ ] Data integrity maintained with 100% accuracy between activities and statistics
- [ ] Successful migration of all existing data without loss
- [ ] Piece statistics remain consistent through all CRUD operations

### Phase 2 Success Metrics
- [ ] Export Pieces to CSV provides comprehensive piece statistics in user-friendly format
- [ ] Import Activities from CSV preserves existing pieces while adding new activity data
- [ ] File operations complete successfully with proper validation and error handling
- [ ] Piece statistics automatically update correctly after activity imports

### Phase 3 Success Metrics
- [ ] Verbose calendar mode provides complete Timeline functionality
- [ ] Smooth performance maintained even with extensive activity data
- [ ] User preference for verbose mode over separate Timeline view
- [ ] Successful integration of edit/delete operations in calendar context

## Cycle Notes

- DevCycle_2025_0004 builds upon the performance foundation established in DC_2025_0003
- Focus on internal optimizations and user experience improvements
- Three phases work toward simplifying app architecture while enhancing functionality
- Phase 1 performance improvements enable future scalability and feature development
- Phase 2 adds enhanced data management capabilities leveraging Phase 1's independent piece storage
- Phase 3 focuses on user interface enhancements for better activity management

## Future Cycles

Next development cycle (2025-0005) will likely focus on:
- Advanced analytics and practice insights based on independent piece data
- User feedback implementation from enhanced import/export functionality
- Additional calendar enhancements and filtering capabilities
- User feedback implementation from verbose calendar mode
- Potential Timeline tab removal and navigation simplification

## Questions

### Phase 1: Independent Piece Information Storage

**Q1: Favorites Storage Strategy**
Should we store favorite piece information separately (dedicated favorites table) or keep favorite status as a field within the pieces table?

*Considerations:*
- Separate table: More normalized, easier to query favorites independently
- Piece field: Simpler schema, fewer joins, but piece table becomes larger

EDNOTE: Separate

**Q2: Import/Export Strategy**
Should we import/export piece statistics information separately from activities, or bundle them together?

*Considerations:*
- Separate export: Clean data separation, user choice of what to backup
- Bundled export: Simpler user experience, ensures data consistency
- Hybrid approach: Main export includes everything, option for separate exports

EDNOTE: Separate

**Q3: Export Format for Statistics**
Should we export piece statistics data as JSON or CSV format?

*Considerations:*
- JSON: Better for complex nested data, preserves data types, more flexible
- CSV: User-friendly for spreadsheet analysis, consistent with current export format
- Both formats: Maximum compatibility but more implementation complexity

EDNOTE: CSV

### Phase 2: Verbose Calendar Mode Toggle

**Q4: Timeline Tab Retention**
Should we keep the Timeline tab as an option, or completely replace it with Verbose Calendar Mode?

*Considerations:*
- Some users may prefer chronological list view
- Timeline may be better for searching across long date ranges
- Calendar provides better visual context for practice patterns

EDNOTE: Keep the timeline tab. 

**Q5: Default Mode**
Should Verbose Calendar Mode be the default for new users, or should users opt-in?

*Considerations:*
- New users may benefit from more information immediately
- Verbose mode may be overwhelming for casual users
- Power users likely prefer detailed information

EDNOTE: Add a Configuration button on the Settings page. ON this new Configuration page, add a toggle for Verbose Calendar. Default to non verbose calendar.

**Q6: Performance with Large Datasets**
How should we handle performance when users have hundreds of activities per month?

*Considerations:*
- Pagination or lazy loading for activity details
- Limit visible activities per day in verbose mode
- Provide filtering options within calendar view

EDNOTE: Pagination for activity details. Limit to 50 activities per page.