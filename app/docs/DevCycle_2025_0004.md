# Development Cycle 2025-0004

**Status:** In Progress  
**Start Date:** 2025-07-26  
**Focus:** Performance Optimization and User Experience Enhancement

## Overview

This development cycle focuses on significant performance improvements and user experience enhancements for PlayStreak. The cycle addresses two major areas: database optimization through independent piece information storage, and calendar interface enhancement with verbose mode functionality.

## Current Work Items

### Phase 1: Independent Piece Information Storage
**Status:** ðŸŽ« **OPEN**  
**Date Added:** 2025-07-26  
**Priority:** High  
**Description:** Implement independent storage of piece statistics and information to reduce database query overhead and improve app performance.

**Acceptance Criteria:**
- [ ] Design and implement enhanced Piece entity with statistical fields
- [ ] Create database migration to populate statistics from existing activities
- [ ] Modify activity CRUD operations to maintain piece statistics
- [ ] Replace expensive activity-based queries with direct piece statistics queries
- [ ] Validate data integrity and performance improvements
- [ ] Handle favorites storage strategy (separate table vs. piece field)
- [ ] Implement import/export strategy for piece statistics
- [ ] Determine export format (JSON vs. CSV) for statistics data

**Technical Implementation Details:**

**Database Schema Enhancement:**
```kotlin
@Entity(tableName = "pieces")
data class Piece(
    @PrimaryKey val id: String,
    val name: String,
    val type: ItemType,
    val dateCreated: Long,
    
    // New independent statistics fields
    val practiceCount: Int = 0,
    val performanceCount: Int = 0,
    val lastPracticeDate: Long? = null,
    val lastPerformanceDate: Long? = null,
    val totalPracticeDuration: Int = 0, // in minutes
    val averagePracticeLevel: Float? = null,
    val lastUpdated: Long = System.currentTimeMillis(),
    
    // Recent activity tracking for better suggestions
    val lastThreePractices: String? = null, // JSON array of timestamps
    val lastThreePerformances: String? = null // JSON array of timestamps
)
```

**Files to Modify:**
- `app/src/main/java/com/pseddev/playstreak/data/entities/Piece.kt`
- `app/src/main/java/com/pseddev/playstreak/data/dao/PieceDao.kt`
- `app/src/main/java/com/pseddev/playstreak/data/dao/ActivityDao.kt`
- `app/src/main/java/com/pseddev/playstreak/data/AppDatabase.kt` (migration)
- `app/src/main/java/com/pseddev/playstreak/data/repositories/ActivityRepository.kt`
- `app/src/main/java/com/pseddev/playstreak/ui/progress/DashboardViewModel.kt`
- `app/src/main/java/com/pseddev/playstreak/ui/pieces/PiecesViewModel.kt`

**Expected Performance Benefits:**
- Piece-related queries execute in <50ms (down from current 200ms+)
- Faster piece list loading with pre-calculated statistics
- Improved suggestions performance with cached activity data
- Scalable architecture that maintains performance as database grows

**Implementation Sub-Phases:**
1. **Database Schema Design** (1-2 days): Create migration and statistics schema
2. **Data Population** (1-2 days): Migrate existing data and validate integrity
3. **Update Logic Implementation** (2-3 days): Modify CRUD operations for statistics maintenance
4. **Query Optimization** (2-3 days): Replace activity-based queries with statistics queries
5. **Testing & Validation** (1-2 days): Performance testing and user acceptance validation

**Future Benefits:**
- Enables activity database trimming while preserving essential statistics
- Foundation for advanced analytics and predictive suggestions
- Long-term data management without losing core information

### Phase 2: Verbose Calendar Mode Toggle
**Status:** ðŸŽ« **OPEN**  
**Date Added:** 2025-07-26  
**Priority:** Medium  
**Description:** Add toggle functionality for verbose calendar mode that shows detailed daily activities with edit/delete capabilities, potentially consolidating Calendar and Timeline functionality.

**Acceptance Criteria:**
- [ ] Implement toggle switch in calendar toolbar with preference storage
- [ ] Create expandable day cells showing detailed activity information
- [ ] Integrate edit/delete functionality for activities directly in calendar
- [ ] Add quick-add capability for selected calendar days
- [ ] Ensure smooth performance with large activity datasets
- [ ] Evaluate Timeline tab necessity after verbose mode implementation
- [ ] Implement smooth expand/collapse animations
- [ ] Add comprehensive testing and user feedback collection

**Technical Implementation Details:**

**UI Enhancement Components:**
```kotlin
// Enhanced calendar day representation
data class VerboseCalendarDay(
    val date: LocalDate,
    val activities: List<Activity>,
    val isExpanded: Boolean = false,
    val totalDuration: Int,
    val practiceCount: Int,
    val performanceCount: Int
)
```

**Files to Modify:**
- `app/src/main/java/com/pseddev/playstreak/ui/progress/CalendarFragment.kt`
- `app/src/main/java/com/pseddev/playstreak/ui/progress/CalendarViewModel.kt`
- `app/src/main/res/layout/fragment_calendar.xml`
- `app/src/main/res/layout/calendar_day_verbose.xml` (new)
- `app/src/main/java/com/pseddev/playstreak/ui/progress/CalendarDayAdapter.kt` (new)
- `app/src/main/java/com/pseddev/playstreak/utils/PreferencesManager.kt`

**User Experience Features:**
- **Day Selection**: Tap to expand detailed activity view for any day
- **Activity Management**: Edit, delete, and add activities directly from calendar context
- **Visual Integration**: Maintain calendar's visual practice pattern representation
- **Toggle Persistence**: Remember user preference between app sessions

**Implementation Sub-Phases:**
1. **Basic Verbose Mode** (2-3 days): Toggle functionality and expandable day cells
2. **Interactive Features** (2-3 days): Edit/delete/add functionality integration
3. **UI Polish & Performance** (1-2 days): Animations and optimization
4. **Timeline Evaluation** (1-2 days): Assessment of Timeline tab necessity

**Timeline Tab Consideration:**
This feature may allow consolidation of Calendar and Timeline functionality, simplifying app navigation while providing enhanced user experience. Evaluation will determine whether Timeline tab remains necessary.


## Success Criteria

### Phase 1 Success Metrics
- [ ] Database query performance improved by 75% for piece-related operations
- [ ] Data integrity maintained with 100% accuracy between activities and statistics
- [ ] Successful migration of all existing data without loss
- [ ] Piece statistics remain consistent through all CRUD operations

### Phase 2 Success Metrics
- [ ] Verbose calendar mode provides complete Timeline functionality
- [ ] Smooth performance maintained even with extensive activity data
- [ ] User preference for verbose mode over separate Timeline view
- [ ] Successful integration of edit/delete operations in calendar context

## Cycle Notes

- DevCycle_2025_0004 builds upon the performance foundation established in DC_2025_0003
- Focus on internal optimizations and user experience improvements
- Both phases work toward simplifying app architecture while enhancing functionality
- Performance improvements enable future scalability and feature development

## Future Cycles

Next development cycle (2025-0005) will likely focus on:
- Advanced analytics and practice insights based on independent piece data
- Additional calendar enhancements and filtering capabilities
- User feedback implementation from verbose calendar mode
- Potential Timeline tab removal and navigation simplification

## Questions

### Phase 1: Independent Piece Information Storage

**Q1: Favorites Storage Strategy**
Should we store favorite piece information separately (dedicated favorites table) or keep favorite status as a field within the pieces table?

*Considerations:*
- Separate table: More normalized, easier to query favorites independently
- Piece field: Simpler schema, fewer joins, but piece table becomes larger

EDNOTE: Separate

**Q2: Import/Export Strategy**
Should we import/export piece statistics information separately from activities, or bundle them together?

*Considerations:*
- Separate export: Clean data separation, user choice of what to backup
- Bundled export: Simpler user experience, ensures data consistency
- Hybrid approach: Main export includes everything, option for separate exports

EDNOTE: Separate

**Q3: Export Format for Statistics**
Should we export piece statistics data as JSON or CSV format?

*Considerations:*
- JSON: Better for complex nested data, preserves data types, more flexible
- CSV: User-friendly for spreadsheet analysis, consistent with current export format
- Both formats: Maximum compatibility but more implementation complexity

EDNOTE: CSV

### Phase 2: Verbose Calendar Mode Toggle

**Q4: Timeline Tab Retention**
Should we keep the Timeline tab as an option, or completely replace it with Verbose Calendar Mode?

*Considerations:*
- Some users may prefer chronological list view
- Timeline may be better for searching across long date ranges
- Calendar provides better visual context for practice patterns

EDNOTE: Keep the timeline tab. 

**Q5: Default Mode**
Should Verbose Calendar Mode be the default for new users, or should users opt-in?

*Considerations:*
- New users may benefit from more information immediately
- Verbose mode may be overwhelming for casual users
- Power users likely prefer detailed information

EDNOTE: Add a Configuration button on the Settings page. ON this new Configuration page, add a toggle for Verbose Calendar. Default to non verbose calendar.

**Q6: Performance with Large Datasets**
How should we handle performance when users have hundreds of activities per month?

*Considerations:*
- Pagination or lazy loading for activity details
- Limit visible activities per day in verbose mode
- Provide filtering options within calendar view

EDNOTE: Pagination for activity details. Limit to 50 activities per page.