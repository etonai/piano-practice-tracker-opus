# Development Cycle 2025-0005

**Status:** ✅ **COMPLETED**  
**Start Date:** 2025-07-27  
**Completion Date:** 2025-07-27  
**Focus:** User Experience Enhancements, Statistics, Build Configuration, UI Text Corrections, and Timeline Evaluation  
**Testing Build:** 1.0.8.20-beta

## Overview

This development cycle will build upon the performance optimizations and user experience enhancements completed in DevCycle_2025_0004. The focus includes adding user statistics to the Settings screen, implementing build-variant conditional visibility for development buttons, correcting import/export button text to accurately reflect current functionality, and temporarily hiding the Timeline tab to evaluate user preference for Calendar Activities Detail Mode. These changes create a cleaner production experience while maintaining full testing capabilities, ensuring UI text accuracy, and optimizing performance by disabling unused Timeline functionality.

## Current Work Items

### Phase 1: Settings Screen Statistics Display
**Status:** ✅ **COMPLETED**  
**Date Added:** 2025-07-27  
**Date Completed:** 2025-07-27  
**Priority:** Medium  
**Description:** Add PlayStreak usage statistics to the Settings screen, displaying the total number of activities, pieces, and favorites after the "all rights reserved" message.

**Acceptance Criteria:**
- [x] Add statistics section below "all rights reserved" message on Settings screen
- [x] Display total number of activities from database
- [x] Display total number of pieces/techniques from database
- [x] Display total number of favorites from database
- [x] Use proper formatting and styling consistent with Settings screen design
- [x] Ensure statistics update in real-time when user navigates to Settings
- [x] Handle edge cases (zero counts, loading states)

**Technical Implementation Details:**

**Statistics Display Layout:**
```xml
<!-- Add to Settings layout after all rights reserved message -->
<LinearLayout
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_marginTop="16dp"
    android:orientation="vertical">
    
    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="PlayStreak Statistics"
        android:textAppearance="?attr/textAppearanceSubtitle2"
        android:layout_marginBottom="8dp" />
    
    <TextView
        android:id="@+id/activitiesCountText"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Activities: 0"
        android:textAppearance="?attr/textAppearanceBody2" />
    
    <TextView
        android:id="@+id/piecesCountText"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Pieces: 0"
        android:textAppearance="?attr/textAppearanceBody2" />
    
    <TextView
        android:id="@+id/favoritesCountText"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Favorites: 0"
        android:textAppearance="?attr/textAppearanceBody2" />
        
</LinearLayout>
```

**Files to Modify:**
- Settings screen layout file (location TBD - needs codebase inspection)
- Settings fragment/activity (location TBD - needs codebase inspection)
- `app/src/main/java/com/pseddev/playstreak/data/repository/PianoRepository.kt` (add statistics query methods)

**Files to Create:**
- None (using existing repository and UI patterns)

**User Experience Features:**
- **Real-time Statistics**: Statistics update when user navigates to Settings screen
- **Clear Presentation**: Statistics are clearly labeled and easy to read
- **Consistent Styling**: Matches existing Settings screen design patterns
- **Performance**: Uses efficient database queries to calculate counts
- **Edge Case Handling**: Graceful display for zero counts and loading states

**Implementation Sub-Phases:**
1. **Codebase Discovery** (0.5 days): Locate Settings screen files and current layout structure
2. **Repository Methods** (0.5 days): Add count query methods to PianoRepository
3. **UI Implementation** (1 day): Add statistics layout and populate with data
4. **Testing & Polish** (0.5 days): Verify statistics accuracy and UI consistency

**Implementation Summary:**
- ✅ Added PlayStreak Statistics section to MainFragment layout after "All Rights Reserved" text
- ✅ Leveraged existing MainViewModel statistics: activitiesCount, piecesCount, favoritesCount
- ✅ Connected real-time data observers to populate statistics TextViews automatically
- ✅ Used consistent styling and center-aligned layout matching Settings screen design
- ✅ No repository changes needed - existing statistics infrastructure was sufficient
- ✅ Statistics update immediately when navigating to Settings via existing observer pattern

### Phase 2: Testing-Only Button Visibility Control
**Status:** ✅ **COMPLETED**  
**Date Added:** 2025-07-27  
**Date Completed:** 2025-07-27  
**Priority:** Medium  
**Description:** Implement build-variant conditional visibility for testing/development buttons in Settings screen. Hide Add Activity, Add Piece, Manage Favorites, and Connect to Google Drive buttons (and accompanying text) in production builds while keeping them visible in testing builds, following the existing pattern used by the purge data button.

**Acceptance Criteria:**
- [x] Identify and analyze existing purge data button visibility implementation pattern
- [x] Apply same visibility control pattern to Add Activity button in Settings
- [x] Apply same visibility control pattern to Add Piece button in Settings  
- [x] Apply same visibility control pattern to Manage Favorites button in Settings
- [x] Apply same visibility control pattern to Connect to Google Drive button in Settings
- [x] Apply same visibility control pattern to Connect to Google Drive text/description in Settings
- [x] Verify all buttons and text are visible in debug/testing builds
- [x] Verify all buttons and text are hidden in release/production builds
- [x] Ensure build configuration maintains existing functionality for testing
- [x] Update any related documentation or comments in code

**Technical Implementation Details:**

**Build Variant Visibility Pattern:**
```kotlin
// Follow existing pattern used by purge data button
// Likely implementation in Settings fragment/activity:

if (BuildConfig.DEBUG) {
    // Show testing buttons and text in debug builds
    addActivityButton.visibility = View.VISIBLE
    addPieceButton.visibility = View.VISIBLE
    manageFavoritesButton.visibility = View.VISIBLE
    connectGoogleDriveButton.visibility = View.VISIBLE
    googleDriveDescriptionText.visibility = View.VISIBLE
} else {
    // Hide testing buttons and text in release builds
    addActivityButton.visibility = View.GONE
    addPieceButton.visibility = View.GONE
    manageFavoritesButton.visibility = View.GONE
    connectGoogleDriveButton.visibility = View.GONE
    googleDriveDescriptionText.visibility = View.GONE
}
```

**Files to Modify:**
- Settings screen layout file (location TBD - needs codebase inspection)
- Settings fragment/activity (location TBD - needs codebase inspection)
- Build configuration files if needed (build.gradle.kts)

**Files to Create:**
- None (using existing build variant patterns)

**User Experience Features:**
- **Clean Production UI**: Production users see streamlined Settings without development buttons or Google Drive options
- **Full Testing Access**: Developers and testers retain full functionality access including Google Drive integration
- **Consistent Pattern**: Uses same visibility logic as existing purge data button
- **Build Safety**: Automatically handles visibility based on build type
- **No Functional Impact**: Testing functionality remains unchanged in appropriate builds
- **Complete UI Control**: Hides both buttons and related descriptive text for Google Drive features

**Implementation Sub-Phases:**
1. **Pattern Analysis** (0.5 days): Examine existing purge data button implementation
2. **Visibility Implementation** (1 day): Apply conditional visibility to four target buttons and Google Drive text
3. **Build Testing** (0.5 days): Test visibility in both debug and release builds
4. **Code Review & Polish** (0.5 days): Ensure consistency and clean implementation

**Implementation Summary:**
- ✅ Identified and analyzed existing purge data button visibility pattern using BuildConfig.DEBUG
- ✅ Applied same pattern to Add Activity, Add Piece, and Manage Favorites buttons in MainFragment
- ✅ Applied visibility control to Google Drive card and sync button in ImportExportFragment
- ✅ Used consistent BuildConfig.DEBUG conditional visibility pattern throughout
- ✅ All testing/development buttons now hidden in production builds, visible in debug builds
- ✅ Maintains existing functionality for testing and development workflows

### Phase 3: Import/Export Button Text Corrections
**Status:** ✅ **COMPLETED**  
**Date Added:** 2025-07-27  
**Date Completed:** 2025-07-27  
**Priority:** Low  
**Description:** Update import and export button text to accurately reflect current functionality. Change "Import Activities from CSV" and "Export Activities to CSV" to "Import Data" and "Export Data" to reflect that the features now support both activities and pieces, and both CSV and JSON formats.

**Acceptance Criteria:**
- [x] Change "Import Activities from CSV" button text to "Import Data"
- [x] Change "Export Activities to CSV" button text to "Export Data" 
- [x] Verify button text changes don't break layout or styling
- [x] Ensure accessibility labels and content descriptions are updated if needed
- [x] Update any related help text or tooltips to reflect new functionality
- [x] Test button functionality remains unchanged after text updates

**Technical Implementation Details:**

**Button Text Updates:**
```xml
<!-- Update in Import/Export layout file -->
<!-- Before: -->
<Button
    android:text="Import Activities from CSV"
    android:contentDescription="Import Activities from CSV" />
    
<Button
    android:text="Export Activities to CSV"
    android:contentDescription="Export Activities to CSV" />

<!-- After: -->
<Button
    android:text="Import Data"
    android:contentDescription="Import data from CSV or JSON file" />
    
<Button
    android:text="Export Data"
    android:contentDescription="Export data to CSV or JSON file" />
```

**Files to Modify:**
- Import/Export screen layout file (location TBD - needs codebase inspection)
- `app/src/main/res/values/strings.xml` (if button text is externalized)
- Any related help or dialog text that references old functionality

**Files to Create:**
- None (text-only updates)

**User Experience Features:**
- **Accurate Labeling**: Button text now reflects true functionality (data vs. activities only)
- **Format Flexibility**: Text indicates support for multiple formats (CSV and JSON)
- **Clear Intent**: "Import Data" and "Export Data" are more concise and clear
- **Accessibility**: Updated content descriptions provide accurate information for screen readers
- **Consistency**: Aligns button text with actual feature capabilities from DevCycle_2025_0004

**Implementation Sub-Phases:**
1. **Text Location Discovery** (0.25 days): Locate all import/export button text references
2. **Text Updates** (0.5 days): Update button text and accessibility labels
3. **Layout Verification** (0.25 days): Ensure text changes don't affect button sizing or layout
4. **Testing** (0.25 days): Verify functionality and accessibility after changes

**Implementation Summary:**
- ✅ Updated "Export Activities to CSV" button text to "Export Data" in fragment_import_export.xml
- ✅ Updated "Import Activities from CSV" button text to "Import Data" in fragment_import_export.xml  
- ✅ Added content descriptions for accessibility: "Export data to CSV or JSON file" and "Import data from CSV or JSON file"
- ✅ Verified button layout and styling remain unchanged after text updates
- ✅ Text now accurately reflects multi-format support (CSV and JSON) and multi-data support (activities and pieces)
- ✅ No string resources needed updating - text was hardcoded in layout files

### Phase 4: Timeline Tab Evaluation - Temporary Removal
**Status:** ✅ **COMPLETED**  
**Date Added:** 2025-07-27  
**Date Completed:** 2025-07-27  
**Priority:** Medium  
**Description:** Temporarily hide the Timeline tab and disable Timeline data population to evaluate user preference for Calendar Activities Detail Mode vs. separate Timeline functionality. Comment out Timeline features while preserving code for quick restoration if needed.

**Acceptance Criteria:**
- [x] Hide Timeline tab from main navigation without removing underlying code
- [x] Comment out Timeline data population logic to prevent unnecessary database queries
- [x] Disable Timeline fragment initialization and lifecycle methods
- [x] Ensure app navigation works properly without Timeline tab
- [x] Comment out Timeline-related ViewModels and repository methods rather than deleting
- [x] Verify Calendar Activities Detail Mode provides adequate Timeline functionality replacement
- [x] Document restoration process for quick Timeline re-enabling if needed
- [x] Test app stability and performance with Timeline functionality disabled

**Technical Implementation Details:**

**Timeline Tab Hiding Strategy:**
```kotlin
// In main navigation setup (likely MainFragment or Navigation component)
// Comment out Timeline tab registration:

/*
// Timeline Tab - Temporarily disabled for evaluation
binding.bottomNavigation.menu.add(Menu.NONE, R.id.timeline_fragment, Menu.NONE, "Timeline")
    .setIcon(R.drawable.ic_timeline)
*/

// Or if using ViewPager with tabs:
/*
// Timeline tab setup - temporarily disabled
viewPagerAdapter.addFragment(TimelineFragment(), "Timeline")
*/
```

**Timeline Data Population Disabling:**
```kotlin
// In repository or relevant data loading methods:
// Comment out Timeline-specific data queries:

/*
// Timeline data loading - temporarily disabled for evaluation
fun loadTimelineData(): LiveData<List<TimelineItem>> {
    return timelineDao.getAllTimelineItems()
}
*/

// In ViewModels:
/*
// Timeline ViewModel data loading - temporarily disabled
private val timelineData = repository.loadTimelineData()
*/
```

**Timeline Fragment Commenting:**
```kotlin
// In TimelineFragment:
/*
// Timeline Fragment functionality - temporarily disabled for evaluation
override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
    super.onViewCreated(view, savedInstanceState)
    // Implementation commented out
}
*/
```

**Files to Modify:**
- Main navigation setup file (location TBD - needs codebase inspection)
- `app/src/main/java/com/pseddev/playstreak/ui/progress/TimelineFragment.kt` (comment out methods)
- `app/src/main/java/com/pseddev/playstreak/ui/progress/TimelineViewModel.kt` (comment out data loading)
- `app/src/main/java/com/pseddev/playstreak/data/repository/PianoRepository.kt` (comment out Timeline queries)
- Navigation graph or ViewPager adapter files
- Bottom navigation menu files

**Files to Create:**
- None (preservation-focused approach using comments)

**User Experience Features:**
- **Clean Navigation**: Users see streamlined navigation without Timeline option
- **Performance Optimization**: No Timeline data queries reduce database load
- **Calendar Focus**: Users directed to Calendar Activities Detail Mode for activity viewing
- **Quick Restoration**: All Timeline code preserved via comments for easy re-enabling
- **Evaluation Ready**: Clean test environment to assess user preference and app performance

**Implementation Sub-Phases:**
1. **Navigation Analysis** (0.5 days): Identify all Timeline tab navigation references
2. **Data Query Disabling** (0.5 days): Comment out Timeline data population and queries
3. **Fragment Commenting** (0.5 days): Comment out Timeline fragment functionality while preserving code
4. **Testing & Validation** (0.5 days): Verify app works properly without Timeline and performance is improved
5. **Documentation** (0.25 days): Document restoration process for potential Timeline re-enabling

**Implementation Summary:**
- ✅ Removed Timeline tab from ViewProgressFragment navigation (position 4)
- ✅ Reduced tab count from 6/5 to 5/4 (Pro/Free users) in ViewProgressPagerAdapter
- ✅ Commented out Timeline data loading in TimelineViewModel to prevent database queries
- ✅ Disabled TimelineFragment onViewCreated() functionality while preserving all code
- ✅ Added comprehensive restoration documentation in all modified files
- ✅ Used comment-based approach to preserve all Timeline functionality for quick restoration
- ✅ Timeline functionality can be restored by uncommenting 3 code blocks and adjusting tab positions

### Phase 5: Fix Suggestions Display Bugs
**Status:** ✅ **COMPLETED**  
**Date Added:** 2025-07-27  
**Date Completed:** 2025-07-27  
**Priority:** High  
**Description:** Fix critical bugs in practice suggestions display. Free users are seeing too many favorite suggestions (4 instead of 1), and there's inconsistency between Dashboard suggestions (3 favorites) and Suggestions tab (4 favorites). Both screens should show the same suggestions with proper free user limits applied.

**Acceptance Criteria:**
- [x] Investigate why free users see 4 favorite suggestions instead of 1 in Suggestions tab
- [x] Investigate why Dashboard shows 3 favorite suggestions vs. Suggestions tab showing 4
- [x] Fix favorite suggestion limits to enforce 1 favorite for free users, 4 for Pro users
- [x] Ensure Dashboard and Suggestions tab show identical suggestion sets
- [x] Verify non-favorite suggestion limits work correctly (2 for free, 4 for Pro)
- [x] Test with both free and Pro user modes to confirm proper limits
- [x] Ensure suggestion algorithms between Dashboard and Suggestions tab are synchronized
- [x] Fix any Pro user status detection issues if present

**Technical Implementation Details:**

**Root Cause Analysis Required:**
```kotlin
// SuggestionsViewModel.kt lines 114 & 169 show correct limits:
val favoriteLimit = if (proUserManager.isProUser()) 4 else 1  // Should be 1 for free
val nonFavoriteLimit = if (proUserManager.isProUser()) 4 else 2  // Should be 2 for free

// Potential issues to investigate:
// 1. ProUserManager.isProUser() returning incorrect value
// 2. Dashboard using different suggestion logic than Suggestions tab
// 3. Fallback logic (lines 117-166) overriding limits incorrectly
// 4. Multiple suggestion sources causing limit bypass
```

**Dashboard vs. Suggestions Tab Consistency:**
```kotlin
// Dashboard suggestion logic location TBD - needs codebase inspection
// Must ensure Dashboard uses same:
// - ProUserManager.isProUser() check
// - favoriteLimit and nonFavoriteLimit values  
// - Suggestion filtering and sorting algorithms
// - Exclusion criteria (pieces practiced today, etc.)
```

**Free User Limit Enforcement:**
```kotlin
// Verify these limits are strictly enforced:
// Free users: 1 favorite + 2 non-favorite = 3 total practice suggestions
// Pro users: 4 favorites + 4 non-favorites = 8 total practice suggestions

// Check fallback logic doesn't exceed limits:
if (favoriteSuggestions.size < favoriteLimit) {
    // Ensure fallback additions don't exceed favoriteLimit
    val neededCount = favoriteLimit - favoriteSuggestions.size
    // Fallback must respect this limit
}
```

**Files to Investigate:**
- `app/src/main/java/com/pseddev/playstreak/ui/progress/SuggestionsViewModel.kt` (favorite limit logic)
- `app/src/main/java/com/pseddev/playstreak/utils/ProUserManager.kt` (Pro status detection)
- Dashboard fragment/ViewModel (location TBD - needs discovery for suggestion logic)
- `app/src/main/java/com/pseddev/playstreak/ui/progress/SuggestionsFragment.kt` (display logic)

**Files to Modify:**
- SuggestionsViewModel.kt (if fallback logic exceeds limits)
- Dashboard suggestion logic files (TBD after discovery)
- ProUserManager.kt (if Pro status detection is incorrect)
- Any shared suggestion utility classes (TBD after discovery)

**User Experience Features:**
- **Correct Free Limits**: Free users see exactly 1 favorite + 2 non-favorite suggestions
- **Consistent Display**: Dashboard and Suggestions tab show identical suggestion sets
- **Pro User Support**: Pro users continue to see 4 favorites + 4 non-favorites correctly
- **Reliable Status Detection**: Pro user status correctly determined and applied
- **Performance**: No unnecessary suggestion calculations or database queries

**Implementation Sub-Phases:**
1. **Root Cause Analysis** (1 day): Investigate Pro status detection and suggestion limit enforcement
2. **Dashboard Discovery** (0.5 days): Locate Dashboard suggestion logic and compare with Suggestions tab
3. **Bug Fixes** (1-2 days): Fix limit enforcement and synchronize suggestion algorithms
4. **Testing & Validation** (0.5 days): Test with both free and Pro modes to verify correct limits

**Critical Investigation Points:**
- Current Pro user status: Check if app incorrectly detects user as Pro
- Fallback logic in SuggestionsViewModel: Verify it respects favoriteLimit  
- Dashboard suggestion source: Identify if Dashboard uses different suggestion logic
- Suggestion counting: Confirm suggestions are properly counted against limits

**Implementation Summary:**
- ✅ Identified root cause: Dashboard shows only practice suggestions, Suggestions tab shows practice + performance suggestions
- ✅ Fixed SuggestionsViewModel to enforce favorite limits (1 for free, 4 for Pro) across all suggestion types combined
- ✅ Synchronized DashboardViewModel to include performance suggestions like Suggestions tab
- ✅ Added favorite limit enforcement in both ViewModels to prevent limit bypass
- ✅ ProUserManager.isProUser() confirmed working correctly (defaults to false for free users)
- ✅ Both screens now use identical suggestion algorithms and will show same suggestions with proper limits
- ✅ Performance suggestions are Pro-only and both ViewModels respect this correctly
- ✅ Free users will see exactly 1 favorite + 2 non-favorite practice suggestions plus Pro performance suggestions (if applicable)

## Success Criteria

### Phase 1 Success Metrics
- [x] Statistics display correctly on Settings screen without layout issues
- [x] All three statistics (activities, pieces, favorites) show accurate counts
- [x] Statistics update in real-time when user navigates to Settings
- [x] Performance remains responsive with efficient database queries
- [x] UI styling is consistent with existing Settings screen design

### Phase 2 Success Metrics
- [x] All four target buttons (Add Activity, Add Piece, Manage Favorites, Connect to Google Drive) are hidden in production builds
- [x] Google Drive descriptive text is hidden in production builds
- [x] All buttons and text remain visible and functional in debug/testing builds
- [x] Implementation follows existing purge data button pattern consistently
- [x] No build errors or configuration issues introduced
- [x] Settings screen layout remains clean and professional in production builds

### Phase 3 Success Metrics
- [x] Import button displays "Import Data" text correctly
- [x] Export button displays "Export Data" text correctly
- [x] Button layout and styling remain consistent after text changes
- [x] Content descriptions accurately reflect multi-format support
- [x] All import/export functionality works identically to before text changes

### Phase 4 Success Metrics
- [x] Timeline tab is completely hidden from main navigation
- [x] Timeline data population queries are disabled (no database performance impact)
- [x] App navigation works smoothly without Timeline tab present
- [x] Calendar Activities Detail Mode provides adequate Timeline functionality replacement
- [x] All Timeline code remains intact and easily restorable via uncommenting
- [x] App performance improves with Timeline data loading disabled
- [x] No crashes or navigation errors introduced by Timeline removal

### Phase 5 Success Metrics
- [x] Free users see exactly 1 favorite suggestion in Suggestions tab (not 4)
- [x] Dashboard and Suggestions tab show identical favorite suggestion counts
- [x] Pro user status detection works correctly for suggestion limits
- [x] Fallback suggestion logic respects favoriteLimit and nonFavoriteLimit boundaries
- [x] Non-favorite suggestion limits work correctly (2 for free, 4 for Pro)
- [x] Both Dashboard and Suggestions tab use synchronized suggestion algorithms
- [x] No performance degradation from suggestion logic fixes
- [x] Suggestion display is consistent between app sessions and user modes

## Cycle Notes

- DevCycle_2025_0005 builds upon the completed performance foundation from DevCycle_2025_0004
- All phases from DevCycle_2025_0004 were successfully completed on 2025-07-27
- ✅ Phase 1 completed: user statistics display in Settings screen
- ✅ Phase 2 completed: build-variant conditional visibility for development buttons
- ✅ Phase 3 completed: correcting import/export button text for accuracy
- ✅ Phase 4 completed: Timeline tab evaluation through temporary removal
- ✅ Phase 5 completed: critical suggestions display bugs affecting free user experience fixed
- Calendar Activities Detail Mode implementation from DevCycle_2025_0004 enables Timeline evaluation
- **All five phases successfully completed on 2025-07-27**
- **Testing completed with build 1.0.8.20-beta**
- DevCycle_2025_0005 successfully completed all objectives for user experience enhancements

## Future Cycles

Next development cycle (2025-0006) will likely focus on:
- Production release and post-launch activities
- User feedback implementation 
- Performance monitoring and optimization
- Feature enhancements based on real usage data

## Questions

### Implementation Planning Questions

**Q1: Development Priorities**
What should be the primary focus areas for DevCycle_2025_0005?

*Considerations:*
- Advanced analytics and practice insights based on Phase 1 piece statistics
- Timeline tab evaluation and potential removal after Phase 4 Calendar implementation
- Additional export/import enhancements 
- User interface improvements and polish
- Performance monitoring and optimization

**Q2: Timeline Tab Strategy**
Should DevCycle_2025_0005 address the Timeline tab evaluation mentioned in DevCycle_2025_0004 Phase 4?

*Considerations:*
- Calendar Activities Detail Mode now provides Timeline functionality
- User feedback on preferred interface (Calendar vs. Timeline)
- Navigation simplification benefits
- Implementation effort for Timeline removal vs. keeping both options

**Q3: Advanced Analytics Implementation**
Should Phase 1 piece statistics be leveraged for advanced user insights?

*Considerations:*
- Practice pattern analysis and recommendations
- Progress tracking and goal setting features
- Performance trends and historical analysis
- Streak calculation enhancements using piece statistics 